# PromiseCard v1 설계서

> 작성일: 2025-02-01
> 버전: v1.0

---

## 1. 시스템 아키텍처

```
[사용자]
    ↓
[Vercel Edge Network]
    ↓
[Next.js App]
    ├── 정적 페이지 (SSG)
    ├── 동적 페이지 (SSR)
    └── API Routes
          ↓
    [Supabase]
     ├── Auth (인증)
     ├── Database (PostgreSQL)
     └── Storage (이미지)
          ↓
    [Cloudinary] (이미지 최적화)
```

---

## 2. 기술 스택

| 분류 | 기술 | 버전 |
|------|------|------|
| Framework | Next.js | 14.x |
| Language | TypeScript | 5.x |
| Styling | Tailwind CSS | 3.x |
| Backend | Supabase | - |
| Database | PostgreSQL | 15.x |
| Deployment | Vercel | - |
| Image CDN | Cloudinary | - |
| Design | Figma | - |

---

## 2.1 디자인 워크플로우

### 도구

| 도구 | 용도 |
|------|------|
| **Figma** | UI/UX 디자인 |
| **Figma MCP** | Claude Code 연동 |

### 프로세스

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Figma     │ → │  MCP 연결   │ → │   Claude    │ → │  코드 리뷰   │
│  UI 디자인   │    │             │    │  코드 구현   │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
     사용자              사용자            Claude            사용자
```

### 디자인 규칙

1. **컴포넌트 기반 설계**
   - Figma 컴포넌트 = React 컴포넌트
   - 재사용 가능한 단위로 분리

2. **네이밍 컨벤션**
   - 컴포넌트: `Category/ComponentName` (예: `Button/Primary`)
   - 레이어: 의미 있는 이름 사용

3. **디자인 토큰**
   - 색상: Figma Variables 사용
   - 간격: 8px 그리드 시스템
   - 폰트: 정의된 스타일만 사용

### Figma → 코드 매핑

| Figma | Tailwind/React |
|-------|----------------|
| Auto Layout (horizontal) | `flex flex-row` |
| Auto Layout (vertical) | `flex flex-col` |
| Gap: 16px | `gap-4` |
| Padding: 16px | `p-4` |
| Fill Container | `w-full` |
| Fixed Width: 200px | `w-[200px]` |
| Corner Radius: 8px | `rounded-lg` |

### MCP 연결 설정

```json
// .mcp.json
{
  "mcpServers": {
    "figma": {
      "command": "npx",
      "args": ["-y", "@anthropic/figma-mcp"]
    }
  }
}
```

---

## 3. 폴더 구조

```
src/
├── app/
│   ├── (auth)/
│   │   ├── login/page.tsx
│   │   └── signup/page.tsx
│   ├── (main)/
│   │   ├── page.tsx              # 홈
│   │   ├── templates/page.tsx    # 템플릿 목록
│   │   └── create/page.tsx       # 청첩장 생성
│   ├── card/
│   │   └── [code]/page.tsx       # 청첩장 보기
│   ├── my/
│   │   └── page.tsx              # 마이페이지
│   └── layout.tsx
├── components/
│   ├── ui/                       # 기본 UI
│   │   ├── Button.tsx
│   │   ├── Input.tsx
│   │   └── Card.tsx
│   ├── features/
│   │   ├── InvitationForm.tsx    # 청첩장 입력 폼
│   │   ├── InvitationPreview.tsx # 미리보기
│   │   ├── TemplateSelector.tsx  # 템플릿 선택
│   │   └── ShareButton.tsx       # 공유 버튼
│   └── layout/
│       ├── Header.tsx
│       ├── Footer.tsx
│       └── MobileNav.tsx
├── lib/
│   ├── supabase/
│   │   ├── client.ts
│   │   └── server.ts
│   └── utils.ts
├── hooks/
│   ├── useInvitation.ts
│   └── useAuth.ts
└── types/
    ├── invitation.ts
    └── database.ts
```

---

## 4. 데이터베이스 설계

### 4.1 ERD

```
┌─────────────────┐       ┌─────────────────┐
│     users       │       │ invitation_cards│
├─────────────────┤       ├─────────────────┤
│ id (PK)         │──────<│ user_id (FK)    │
│ email           │       │ id (PK)         │
│ created_at      │       │ template_id     │
└─────────────────┘       │ groom_name      │
                          │ bride_name      │
                          │ wedding_date    │
                          │ venue_*         │
                          │ share_code (UQ) │
                          │ status          │
                          └────────┬────────┘
                                   │
           ┌───────────────────────┼───────────────────────┐
           │                       │                       │
           ▼                       ▼                       ▼
┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐
│ rsvp_responses  │   │guestbook_entries│   │ card_gallery    │
├─────────────────┤   ├─────────────────┤   ├─────────────────┤
│ id (PK)         │   │ id (PK)         │   │ id (PK)         │
│ card_id (FK)    │   │ card_id (FK)    │   │ card_id (FK)    │
│ guest_name      │   │ author_name     │   │ image_url       │
│ attending       │   │ message         │   │ order           │
│ guest_count     │   │ created_at      │   │ created_at      │
└─────────────────┘   └─────────────────┘   └─────────────────┘
```

### 4.2 주요 테이블

상세 스키마는 `.claude/skills/invitation.md` 참조

---

## 5. API 설계

### 5.1 청첩장 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/cards` | 내 청첩장 목록 |
| POST | `/api/cards` | 청첩장 생성 |
| GET | `/api/cards/[id]` | 청첩장 조회 |
| PUT | `/api/cards/[id]` | 청첩장 수정 |
| DELETE | `/api/cards/[id]` | 청첩장 삭제 |
| GET | `/api/cards/code/[code]` | 공유 코드로 조회 |

### 5.2 이미지 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/upload` | 이미지 업로드 |
| DELETE | `/api/upload/[id]` | 이미지 삭제 |

### 5.3 RSVP API (v1.1)

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/rsvp` | 참석 여부 등록 |
| GET | `/api/rsvp/[cardId]` | 참석자 목록 |

---

## 6. 화면 설계

### 6.1 페이지 목록

| 페이지 | 경로 | 설명 |
|--------|------|------|
| 홈 | `/` | 랜딩 페이지 |
| 템플릿 | `/templates` | 템플릿 선택 |
| 생성 | `/create` | 청첩장 생성 |
| 미리보기 | `/preview/[id]` | 미리보기 |
| 청첩장 | `/card/[code]` | 공개 청첩장 |
| 로그인 | `/login` | 로그인 |
| 마이페이지 | `/my` | 내 청첩장 |

### 6.2 와이어프레임

```
┌─────────────────────────────────────┐
│           PromiseCard               │
│         모바일 청첩장 서비스          │
│                                     │
│    ┌─────────────────────────┐     │
│    │   청첩장 만들기 버튼      │     │
│    └─────────────────────────┘     │
│                                     │
│    ┌─────┐ ┌─────┐ ┌─────┐        │
│    │템플릿│ │템플릿│ │템플릿│        │
│    │  1  │ │  2  │ │  3  │        │
│    └─────┘ └─────┘ └─────┘        │
│                                     │
│    고객후기 | FAQ | 고객센터         │
└─────────────────────────────────────┘
```

---

## 7. 컴포넌트 설계

### 7.1 UI 컴포넌트

| 컴포넌트 | Props | 설명 |
|----------|-------|------|
| Button | variant, size, disabled | 버튼 |
| Input | label, error, type | 입력 필드 |
| Card | children, className | 카드 컨테이너 |
| Modal | open, onClose, title | 모달 |
| DatePicker | value, onChange | 날짜 선택 |

### 7.2 기능 컴포넌트

| 컴포넌트 | Props | 설명 |
|----------|-------|------|
| InvitationForm | onSubmit, defaultValues | 청첩장 폼 |
| TemplateSelector | templates, onSelect | 템플릿 선택 |
| InvitationPreview | data, template | 미리보기 |
| ShareButton | shareCode, title | 공유 버튼 |
| ImageUploader | onUpload, maxFiles | 이미지 업로드 |

---

## 8. 상태 관리

### 8.1 서버 상태
- **Supabase Realtime** 또는 **React Query**

### 8.2 클라이언트 상태
- **React useState** (간단한 상태)
- **Zustand** (전역 상태, 필요시)

---

## 9. 보안 설계

### 9.1 인증
- Supabase Auth (이메일, Google, Kakao)
- JWT 토큰 기반

### 9.2 권한
- RLS (Row Level Security)
- 본인 청첩장만 수정/삭제 가능

### 9.3 데이터 보호
- HTTPS 필수
- 환경변수로 키 관리
- 이미지 URL 서명

---

## 10. 다음 단계

- [ ] 와이어프레임 상세화
- [ ] UI 컴포넌트 개발
- [ ] Supabase 셋업
- [ ] 청첩장 생성 기능 개발
